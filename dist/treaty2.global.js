"use strict";var Eden=(()=>{var R=Object.defineProperty;var U=Object.getOwnPropertyDescriptor;var V=Object.getOwnPropertyNames;var $=Object.prototype.hasOwnProperty;var B=(e,t)=>{for(var n in t)R(e,n,{get:t[n],enumerable:!0})},G=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of V(t))!$.call(e,s)&&s!==n&&R(e,s,{get:()=>t[s],enumerable:!(r=U(t,s))||r.enumerable});return e};var Z=e=>G(R({},"__esModule",{value:!0}),e);var ae={};B(ae,{streamSSEResponse:()=>P,treaty:()=>ie});var w=class extends Error{constructor(n,r){super(r+"");this.status=n;this.value=r}};var z=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,Q=/(?:Sun|Mon|Tue|Wed|Thu|Fri|Sat)\s(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s\d{2}\s\d{4}\s\d{2}:\d{2}:\d{2}\sGMT(?:\+|-)\d{4}\s\([^)]+\)/,X=/^(?:(?:(?:(?:0?[1-9]|[12][0-9]|3[01])[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:19|20)\d{2})|(?:(?:19|20)\d{2}[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:0?[1-9]|[12][0-9]|3[01]))))(?:\s(?:1[012]|0?[1-9]):[0-5][0-9](?::[0-5][0-9])?(?:\s[AP]M)?)?$/,Y=e=>e.trim().length!==0&&!Number.isNaN(Number(e)),K=e=>{if(typeof e!="string")return null;let t=e.replace(/"/g,"");if(z.test(t)||Q.test(t)||X.test(t)){let n=new Date(t);if(!Number.isNaN(n.getTime()))return n}return null},ee=e=>{let t=e.charCodeAt(0),n=e.charCodeAt(e.length-1);return t===123&&n===125||t===91&&n===93},te=e=>JSON.parse(e,(t,n)=>{let r=K(n);return r||n}),M=e=>{if(!e)return e;if(Y(e))return+e;if(e==="true")return!0;if(e==="false")return!1;let t=K(e);if(t)return t;if(ee(e))try{return te(e)}catch{}return e},D=e=>{let t=e.data.toString();return t==="null"?null:M(t)};var T=class{constructor(t){this.url=t;this.ws=new WebSocket(t)}ws;send(t){return Array.isArray(t)?(t.forEach(n=>this.send(n)),this):(this.ws.send(typeof t=="object"?JSON.stringify(t):t.toString()),this)}on(t,n,r){return this.addEventListener(t,n,r)}off(t,n,r){return this.ws.removeEventListener(t,n,r),this}subscribe(t,n){return this.addEventListener("message",t,n)}addEventListener(t,n,r){return this.ws.addEventListener(t,s=>{if(t==="message"){let a=D(s);n({...s,data:a})}else n(s)},r),this}removeEventListener(t,n,r){return this.off(t,n,r),this}close(){return this.ws.close(),this}};var ne=["get","post","put","delete","patch","options","head","connect","subscribe"],J=["localhost","127.0.0.1","0.0.0.0"],C=typeof FileList>"u",q=e=>C?e instanceof Blob:e instanceof FileList||e instanceof File,re=e=>{if(!e)return!1;for(let t in e)if(q(e[t])||Array.isArray(e[t])&&e[t].find(q))return!0;return!1},j=e=>C?e:new Promise(t=>{let n=new FileReader;n.onload=()=>{let r=new File([n.result],e.name,{lastModified:e.lastModified,type:e.type});t(r)},n.readAsArrayBuffer(e)}),v=(e,t,n={},r={})=>{if(Array.isArray(e)){for(let s of e)if(!Array.isArray(s))r=v(s,t,n,r);else{let a=s[0];if(typeof a=="string")r[a.toLowerCase()]=s[1];else for(let[o,y]of a)r[o.toLowerCase()]=y}return r}if(!e)return r;switch(typeof e){case"function":if(e instanceof Headers)return v(e,t,n,r);let s=e(t,n);return s?v(s,t,n,r):r;case"object":if(e instanceof Headers)return e.forEach((a,o)=>{r[o.toLowerCase()]=a}),r;for(let[a,o]of Object.entries(e))r[a.toLowerCase()]=o;return r;default:return r}};async function*P(e){let t=e.body;if(!t)return;let n=t.getReader(),r=new TextDecoder,s="";try{for(;;){let{done:a,value:o}=await n.read();if(a)break;s+=r.decode(o,{stream:!0});let y;for(;(y=s.indexOf(`

`))>=0;){let O=s.slice(0,y);s=s.slice(y+2);let p=I(O);if(p?.event==="error")throw new w(500,p.data);p&&(yield p.data)}}if(s.trim()){let a=I(s);a&&(yield a)}}finally{n.releaseLock()}}function I(e){let t="message",n="",r,s=e.split(`
`);for(let a of s)a.startsWith("event:")?t=a.slice(6).trim():a.startsWith("data:")?n+=a.slice(5).trim():a.startsWith("id:")&&(r=a.slice(3).trim());return!t||!n?null:{event:t,data:se(n),id:r}}function se(e){try{return JSON.parse(e)}catch{return e}}var x=(e,t,n=[],r)=>new Proxy(()=>{},{get(s,a){return x(e,t,a==="index"?n:[...n,a],r)},apply(s,a,[o,y]){if(!o||y||typeof o=="object"&&Object.keys(o).length!==1||ne.includes(n.at(-1))){let O=[...n],p=O.pop(),h="/"+O.join("/"),{fetcher:_=fetch,headers:W,onRequest:g,onResponse:k,fetch:H}=t,E=p==="get"||p==="head"||p==="subscribe";W=v(W,h,y);let N=E?o?.query:y?.query,L="";if(N){let i=(m,S)=>{L+=(L?"&":"?")+`${encodeURIComponent(m)}=${encodeURIComponent(S)}`};for(let[m,S]of Object.entries(N)){if(Array.isArray(S)){for(let f of S)i(m,f);continue}i(m,`${S}`)}}if(p==="subscribe"){let i=e.replace(/^([^]+):\/\//,e.startsWith("https://")?"wss://":e.startsWith("http://")||J.find(m=>e.includes(m))?"ws://":"wss://")+h+L;return new T(i)}return(async()=>{let i={method:p?.toUpperCase(),body:o,...H,headers:W};i.headers={...W,...v(E?o?.headers:y?.headers,h,i)};let m=E&&typeof o=="object"?o.fetch:y?.fetch;if(i={...i,...m},E&&delete i.body,g){Array.isArray(g)||(g=[g]);for(let d of g){let c=await d(h,i);typeof c=="object"&&(i={...i,...c,headers:{...i.headers,...v(c.headers,h,i)}})}}if(E&&delete i.body,re(o)){let d=new FormData;for(let[c,l]of Object.entries(i.body)){if(C){d.append(c,l);continue}if(l instanceof File){d.append(c,await j(l));continue}if(l instanceof FileList){for(let b=0;b<l.length;b++)d.append(c,await j(l[b]));continue}if(Array.isArray(l)){for(let b=0;b<l.length;b++){let F=l[b];d.append(c,F instanceof File?await j(F):F)}continue}d.append(c,l)}i.body=d}else typeof o=="object"?(i.headers["content-type"]="application/json",i.body=JSON.stringify(o)):o!=null&&(i.headers["content-type"]="text/plain");if(E&&delete i.body,g){Array.isArray(g)||(g=[g]);for(let d of g){let c=await d(h,i);typeof c=="object"&&(i={...i,...c,headers:{...i.headers,...v(c.headers,h,i)}})}}let S=e+h+L,f=await(r?.handle(new Request(S,i))??_(S,i)),u=null,A=null;if(k){Array.isArray(k)||(k=[k]);for(let d of k)try{let c=await d(f.clone());if(c!=null){u=c;break}}catch(c){c instanceof w?A=c:A=new w(422,c);break}}if(u!==null)return{data:u,error:A,response:f,status:f.status,headers:f.headers};switch(f.headers.get("Content-Type")?.split(";")[0]){case"text/event-stream":u=P(f);break;case"application/json":u=await f.json();break;case"application/octet-stream":u=await f.arrayBuffer();break;case"multipart/form-data":let d=await f.formData();u={},d.forEach((c,l)=>{u[l]=c});break;default:u=await f.text().then(M)}return(f.status>=300||f.status<200)&&(A=new w(f.status,u),u=null),{data:u,error:A,response:f,status:f.status,headers:f.headers}})()}return typeof o=="object"?x(e,t,[...n,Object.values(o)[0]],r):x(e,t,n)}}),ie=(e,t={})=>typeof e=="string"?(t.keepDomain||(e.includes("://")||(e=(J.find(n=>e.includes(n))?"http://":"https://")+e),e.endsWith("/")&&(e=e.slice(0,-1))),x(e,t)):(typeof window<"u"&&console.warn("Elysia instance server found on client side, this is not recommended for security reason. Use generic type instead."),x("http://e.ly",t,[],e));return Z(ae);})();
