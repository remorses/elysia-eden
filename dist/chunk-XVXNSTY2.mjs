import{a as A,b as T,c as M}from"./chunk-XYW4OUFN.mjs";var F=class{constructor(t){this.url=t;this.ws=new WebSocket(t)}ws;send(t){return Array.isArray(t)?(t.forEach(n=>this.send(n)),this):(this.ws.send(typeof t=="object"?JSON.stringify(t):t.toString()),this)}on(t,n,s){return this.addEventListener(t,n,s)}off(t,n,s){return this.ws.removeEventListener(t,n,s),this}subscribe(t,n){return this.addEventListener("message",t,n)}addEventListener(t,n,s){return this.ws.addEventListener(t,a=>{if(t==="message"){let i=M(a);n({...a,data:i})}else n(a)},s),this}removeEventListener(t,n,s){return this.off(t,n,s),this}close(){return this.ws.close(),this}};var J=["get","post","put","delete","patch","options","head","connect","subscribe"],D=["localhost","127.0.0.1","0.0.0.0"],C=typeof FileList>"u",q=e=>C?e instanceof Blob:e instanceof FileList||e instanceof File,N=e=>{if(!e)return!1;for(let t in e)if(q(e[t])||Array.isArray(e[t])&&e[t].find(q))return!0;return!1},j=e=>C?e:new Promise(t=>{let n=new FileReader;n.onload=()=>{let s=new File([n.result],e.name,{lastModified:e.lastModified,type:e.type});t(s)},n.readAsArrayBuffer(e)}),E=(e,t,n={},s={})=>{if(Array.isArray(e)){for(let a of e)if(!Array.isArray(a))s=E(a,t,n,s);else{let i=a[0];if(typeof i=="string")s[i.toLowerCase()]=a[1];else for(let[o,d]of i)s[o.toLowerCase()]=d}return s}if(!e)return s;switch(typeof e){case"function":if(e instanceof Headers)return E(e,t,n,s);let a=e(t,n);return a?E(a,t,n,s):s;case"object":if(e instanceof Headers)return e.forEach((i,o)=>{s[o.toLowerCase()]=i}),s;for(let[i,o]of Object.entries(e))s[i.toLowerCase()]=o;return s;default:return s}};async function*U(e){let t=e.body;if(!t)return;let n=t.getReader(),s=new TextDecoder,a="";try{for(;;){let{done:i,value:o}=await n.read();if(i)break;a+=s.decode(o,{stream:!0});let d;for(;(d=a.indexOf(`

`))>=0;){let W=a.slice(0,d);a=a.slice(d+2);let p=I(W);if(p?.event==="error")throw new A(500,p.data);p&&(yield p.data)}}if(a.trim()){let i=I(a);i&&(yield i)}}finally{n.releaseLock()}}function I(e){let t="message",n="",s,a=e.split(`
`);for(let i of a)i.startsWith("event:")?t=i.slice(6).trim():i.startsWith("data:")?n+=i.slice(5).trim():i.startsWith("id:")&&(s=i.slice(3).trim());return!t||!n?null:{event:t,data:_(n),id:s}}function _(e){try{return JSON.parse(e)}catch{return e}}var L=(e,t,n=[],s)=>new Proxy(()=>{},{get(a,i){return L(e,t,i==="index"?n:[...n,i],s)},apply(a,i,[o,d]){if(!o||d||typeof o=="object"&&Object.keys(o).length!==1||J.includes(n.at(-1))){let W=[...n],p=W.pop(),g="/"+W.join("/"),{fetcher:P=fetch,headers:x,onRequest:h,onResponse:S,fetch:H}=t,b=p==="get"||p==="head"||p==="subscribe";x=E(x,g,d);let K=b?o?.query:d?.query,R="";if(K){let r=(v,w)=>{R+=(R?"&":"?")+`${encodeURIComponent(v)}=${encodeURIComponent(w)}`};for(let[v,w]of Object.entries(K)){if(Array.isArray(w)){for(let f of w)r(v,f);continue}r(v,`${w}`)}}if(p==="subscribe"){let r=e.replace(/^([^]+):\/\//,e.startsWith("https://")?"wss://":e.startsWith("http://")||D.find(v=>e.includes(v))?"ws://":"wss://")+g+R;return new F(r)}return(async()=>{let r={method:p?.toUpperCase(),body:o,...H,headers:x};r.headers={...x,...E(b?o?.headers:d?.headers,g,r)};let v=b&&typeof o=="object"?o.fetch:d?.fetch;if(r={...r,...v},b&&delete r.body,h){Array.isArray(h)||(h=[h]);for(let l of h){let c=await l(g,r);typeof c=="object"&&(r={...r,...c,headers:{...r.headers,...E(c.headers,g,r)}})}}if(b&&delete r.body,N(o)){let l=new FormData;for(let[c,u]of Object.entries(r.body)){if(C){l.append(c,u);continue}if(u instanceof File){l.append(c,await j(u));continue}if(u instanceof FileList){for(let m=0;m<u.length;m++)l.append(c,await j(u[m]));continue}if(Array.isArray(u)){for(let m=0;m<u.length;m++){let O=u[m];l.append(c,O instanceof File?await j(O):O)}continue}l.append(c,u)}r.body=l}else typeof o=="object"?(r.headers["content-type"]="application/json",r.body=JSON.stringify(o)):o!=null&&(r.headers["content-type"]="text/plain");if(b&&delete r.body,h){Array.isArray(h)||(h=[h]);for(let l of h){let c=await l(g,r);typeof c=="object"&&(r={...r,...c,headers:{...r.headers,...E(c.headers,g,r)}})}}let w=e+g+R,f=await(s?.handle(new Request(w,r))??P(w,r)),y=null,k=null;if(S){Array.isArray(S)||(S=[S]);for(let l of S)try{let c=await l(f.clone());if(c!=null){y=c;break}}catch(c){c instanceof A?k=c:k=new A(422,c);break}}if(y!==null)return{data:y,error:k,response:f,status:f.status,headers:f.headers};switch(f.headers.get("Content-Type")?.split(";")[0]){case"text/event-stream":y=U(f);break;case"application/json":y=await f.json();break;case"application/octet-stream":y=await f.arrayBuffer();break;case"multipart/form-data":let l=await f.formData();y={},l.forEach((c,u)=>{y[u]=c});break;default:y=await f.text().then(T)}return(f.status>=300||f.status<200)&&(k=new A(f.status,y),y=null),{data:y,error:k,response:f,status:f.status,headers:f.headers}})()}return typeof o=="object"?L(e,t,[...n,Object.values(o)[0]],s):L(e,t,n)}}),Q=(e,t={})=>typeof e=="string"?(t.keepDomain||(e.includes("://")||(e=(D.find(n=>e.includes(n))?"http://":"https://")+e),e.endsWith("/")&&(e=e.slice(0,-1))),L(e,t)):(typeof window<"u"&&console.warn("Elysia instance server found on client side, this is not recommended for security reason. Use generic type instead."),L("http://e.ly",t,[],e));export{U as a,Q as b};
